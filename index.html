<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="ProjectBIOS : Three students' attempt to design and implement a BIOS for the Raspberry Pi" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>ProjectBIOS</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ProjectBIOS">View on GitHub</a>

          <h1 id="project_title">ProjectBIOS</h1>
          <h2 id="project_tagline">Three students' attempt to design and implement a BIOS for the Raspberry Pi</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>Welcome to Jacob Deines's Capstone Blog</h1>

<p>This website will be my attempt to track our progress throughout the process of building and designing a BIOS system for the Raspberry Pi. Our team consists of three members, Josh Nelson, Dan Case, and myself. This is a student project at PLU for our capstone class. Our faculty mentor is Dr. Kakar. Our project website can be found at <a href="http://biosproject.github.com/biosRepo/">biosproject.github.com/biosRepo/</a>.</p>

<h2>Our Plan (ORIGINALLY)</h2>

<p>Our plan is to design and implement a Basic Input Output System (BIOS) tailor-made for the Raspberry Pi. The Raspberry Pi uses an ARM processor, so we are still working on if our plan can be implemented as is. If not, we may have to switch to another small system. We are still in the preliminary stages of our research and conceivably will not know for certain if it can be done until we attempt it. For now, we are gung-ho and are excited to try something new and different!</p>

<h2>Benefits</h2>

<p>The potential benefits of this project are many. The first of which is that is is different from the typical project at PLU. Many projects are solely based in high-level coding and design, whereas our project aims to reach through to the lowest levels of abstraction. This experience with low-level coding is a major advantage in the workplace, because it helps us understand and interpret what goes on at a higher level. This understanding gives us an edge when running into problems of design or implementation. We will better understand how software and hardware communicate, potentially revealing previously unseen ways to better our code.</p>

<h2>Timeline (ORIGINALLY)</h2>

<p>Our time line is obviously tentative, as is the hallmark of software development. However, we plan on meeting the following dates with these goals in mind:</p>

<ul>
<li>September: We have been hard at work conducting research and planning</li>
<li>October:   We plan on having our requirements document finalized</li>
<li>November:  Our plan is to have completed at least preliminary function testing on the Raspberry Pi</li>
<li>December:  Our project plan should be finished and we should be starting implementation</li>
<li>January:   We hope to have implemented our BIOS POST (Power On Self-Test)</li>
<li>February:  Implement hardware configuration</li>
<li>March:     Nail down boot-strapping</li>
<li>April:     Complete development and testing of our BIOS</li>
<li>May:       Present our project</li>
</ul><hr><h1>Blog</h1>

<h2>2/22/2013</h2>

<p>Hello again, everybody! It's been a long while since my last post, so there is a lot to go over. As you know, the scope of our project has narrowed. This is good. Over Christmas break and J-Term, we worked on the project individually. Attempts at communication were met with silence. This is bad. However, as we got back and met up again, good things came to light. First and foremost, we now have our Raspberry Pi and it is up and running with Arch Linux ARM. We also have the ARM JTAG, which will help us program and examine processes on the Pi. Preliminary testing is showing promising results as we have a piece of prototyped code that we can insert into the boot sequence, which should be able to execute our code before the RPi boots into the OS. Thanks to Josh for finding the code and for buying the RPi with all its peripherals.</p>

<p>I have been working on getting our program to display to the screen. According to my research, most monitors have their own BIOS and hardware, which allows them to switch states between a "regular" graphics mode to "text" mode. Text mode works like a terminal screen, and is the screen mode when one sees the blue screen of death. To access that mode, all we need to do is send a command in Assembly to the CPU telling it what to do and then execute a specific interrupt that tells it to apply this action to the screen. The only problem with this is that it requires the processor to be in "Real mode" to work. Real mode is the first mode of all Intel x8086 chips (as far as I can tell) and is basically a 16-bit mode that enables the BIOS to perform its functions more efficiently. After the BIOS is done setting stuff up, the CPU switches from real mode to "Protected mode", where most computing is done.</p>

<p>There is, however a way around this. I haven't gotten it to work yet, but I have code examples and information that points to some C with inline Assembly (or just straight-up Assembly) that will initialize the right registers and set the screen to text mode. I am concerned, however. As the chip on the RPi is not x8086 and is in fact RISC, there is a good possibility that some of what I am learning is different, or worse, not used at all. I assume the registers and Assembly will be similar enough to figure out, but I have my doubts as to whether the Broadcom chip has a similar 16-bit mode. Also, the screen already displays information at the point of our interrupt, so we might get lucky and not need this snippet of code in the first place. If that is the case, we will simply need to write what we want into the video buffer (found at x8000 from my research, also might be different on RPi) and we have video output! There are also hints of tools we may be able to use that will help design a "Text UI" (think more complex than command line, less complex than GUI), instead of having to hard-code all that in. Certainly there is more research to come on this.</p>

<p>I have also been looking up how to write interrupts. So far I have made the distinction between Interrupt Service Routines, Interrupt Handlers, and Hardware Interrupts. It seems each one is distinct and integral for creating a successful interrupt. However, just like earlier, I don't know if they will be necessary, seeing as we have already inserted a file that pauses the current booting sequence until our code is done running. It may be necessary to write them anyway, as we still are not 100% on whether or not we will have access to the keyboard. If we do not, we will have to hand-write all our interrupts and interrupt handlers. If we do have access to the keyboard, we will still at least need to know how check to see what keys are being pressed and how to interact with them.</p>

<p>Dan has been hard at work researching the toolchain to use and what software we will use to develop some of our testing code. He is currently attempting to acquire the necessary resources and get them set up on the lab computers. Josh is working on getting or prototype file, blinky.bin to work fully. This is a binary file he found on GitHub that will theoretically pause the boot process, blink LEDs on the RPi, and then resume normal operation. Josh has been in contact with the author and is awaiting more information to see where this lead can go.</p>

<p>As a group, we will hopefully meet up with John Schock in person either on Saturday or in the very near future. This is very exciting for us because we can finally relay all the information we have in a face-to-face encounter and get him fully caught up to speed. Until next time, cheers!</p>

<h2>12/7/2012</h2>

<p>I missed last week's post due to a swim meet. Sorry about that. Anyway, I have a lot to fill in. First, the scope of our project has changed drastically as of two weeks ago. We found out that much of the init code on the Pi is proprietary, so we can't touch it. What happens is this: when the power is turned on, the Broadcom chip's on-board ROM outputs the memory address of two files on the SD. The first file is the bare-metal init code. This is stuff we didn't want to mess with anyway. The other file is called "start.elf". This file performs the POST and hardware initialization. It in turn points to three files: commandline.txt, config.txt, and kernel.img. The commandline.txt file is at this point somewhat of a mystery, but we assume it is basic code to show what is output to the terminal screen while the hardware is initializing. Kernel.img is the compressed kernel image that loads the linux kernel and booloader so the Pi can make it to the OS. What we are interested in now is that config.txt file. Config.txt holds all the configurations for the hardware, and is essentially what we want to be able to edit.</p>

<p>Our plan now is to send an interrupt call during the boot process, possibly by making a call to our own code in the config.txt file, and executing a GUI that allows users to edit some of the system settings in the config file. In essence, we are stopping the boot process before the bootloader has a chance to kick in, and adding BIOS functionality to the existing RPi EFI boot process. I don't believe we have informed John Schock about this yet, but my goal is to get either Dan or Josh or both to also open up dialogue with John. We all have different questions about our different areas of research, and I believe it would be more beneficial if they relayed that information to him directly, rather than explaining it to me first.</p>

<p>Other than my above attempts at getting my partners to speak to John, I have no complaints. Both are very hard-working and as a trio we tend to be very good about informing each other of what's going on if one of us missed something. Personally, I feel that we are working well on this project and am glad that our scope could be narrowed. It would have taken an incredible amount of work to just get the hardware initialized, and that wasn't even a major part of our project! Now that we have less to worry about, we can buckle down, focus on what needs to be done, and do it.</p>

<p>Our Pi should be coming any day now, and then we will finally be able to tinker with it and start prototyping. What I really want to nail down first is the interrupt call. I feel like we need to know how those work, how to implement them, and when we will be able to do so in the boot process. Another concern is how we will get the GUI running. We are not sure which C libraries will be available to us when the program is compiled (using a toolchain and cross-compiler), which means we don't quite know how hard it will be to set all of that up. After that, I/O will be the next task. To create and edit files at such a low level may prove to be very difficult. I suppose we will just have to wait and see. In the meantime, more research, more books!</p>

<h2>11/23/2012</h2>

<p>Happy Thanksgiving, all! Hope everyone had a good time. This week was academically short (as far as work is considered). I made sure to grab and continue reading "Embedded Linux Primer" and have mainly looked over chapter four this week. Chapter four contains information about kernel configuration and other various low-level settings. Using the "make" function, we can build a kernel if we need to, or build ELF files. I am continuing to take notes and post them on a google doc to be shared with the group.</p>

<p>We will meet with Tosh on Tuesday to look over the graded requirements document. We are also in the process of setting up a meeting time with John Schock at the Intel plant to get an in-person meeting. Other than that, there is not much more to report. Cheers!</p>

<h2>11/17/2012</h2>

<p>First, it's apology time! I have not posted in a short while. These past couple of weeks have been almost completely research based. Josh, Dan, and I are meeting consistently (finally) on Tuesdays and Thursdays from noon to one, which has been very helpful in updating each other with info. Preparing for the upcoming break, each of us has grabbed a book from our collection with the intent on reading it, taking detailed notes, and presenting our findings to the rest of the group. That way we can get through three books in short order.</p>

<p>We continued our search for a bootloader, and found out that the Arch Linux ARM distribution we plan to use implements Das U-Boot. This is very fortunate for us because "Embedded Linux Primer" by Christohper Hallinan discusses in detail the use of Das U-Boot in embedded devices. I am currently reading some preceding chapters and am finding it to be a very good resource. I believe Josh took (or plans to take) one of our books that goes into some depth about the Linux kernel, and Dan will be taking our book on ARM 11.</p>

<p>Correspondence with John has been going well. We had not replied for a while because we did not have questions or, at least, didn't know how to ask the questions we had due to lack of research. We are still waiting on our RPi and will be ordering the ARM JTAG soon. We did not order it right away because we were not sure what it could do or if it would be all that much help; however, a quick explanation by John has be convinced that it could be integral to our project development. One concern is that we will need to change around the GPIO pins on the Pi itself to configure it correctly.</p>

<p>So far, I think we are doing well with time management as a group, but I think we could all do better. I personally have a hard time getting in to the workroom when I don't know what exactly I will be researching, but being there heads off a lot of distractions, and I usually get some good research done. Soon, we plan to meet up in person with John, provided we can all find a suitable time. I think that an in-person meeting would be invaluable when making decisions and acquiring information quickly.</p>

<h2>11/4/2012</h2>

<p>This week was fairly laid back. We got together a couple of times for research, and mostly found more issues that we need to solve, such as finding a compatible bootloader and how to build project files. We ordered a Raspberry Pi kit that includes the Pi, a case, charging cable and SD card. Buying the components individually would have ended up costing more. We are continuing to correspond with John Schock and Tosh has informed us that he will ask John to be a professional mentor, since has been so eager to help us out so far. We have started a research plan for our printed resources. One person takes home one book, reads as much relevant information as possible from it, takes notes, and then shares those notes with the group. That way we can get through several books much faster, and have a good idea of the information in each. All group members are working well together, and we intend to make the best of this long bit of unstructured time. Filling our time with research (especially when we have the Pi in hand) and prototyping will be very helpful.</p>

<h2>10/27/2012</h2>

<p>On Wednesday I went to the library to research for more books. I ended up with five, most of which simply provide an overview of bootstrapping or an explanation of what a BIOS is. However, I found two books which could be of great use, as they have whole chapters on the boot process. All of the books I collected were coincidentally about the Linux kernel, which is actually more helpful than harmful considering the operating system we plan to boot to is going to be a Linux distribution. We finally got to correspond via email with John Schock, and we are finding out that we still have a lot to do. For debugging, we are still working out the kinks, but as we understand it, the ARM JTAG debugger works for our purposes, and we could also use VirtualBox on Linux machines so we have a virtual machine. Mr. Schock suggested that we turn our development more toward an EFI (Extensible Firmware Interface) boot on top of the existing init code for the SoC chip. Otherwise, it would require a lot more work and some legal finagling to continue.</p>

<p>Most of our week was spent working on the Requirements Document. I can say that by the end, we were all exhausted, frustrated, and much more thoroughly knowledgeable about our own project. I did have one complaint, which I expressed in rant form to Josh and Dan earlier in the week. I was frustrated because we were not getting our documents in to Tosh to review. The response I would get when I would suggest it, was that the document was unpolished enough to send to review. I explained that Tosh is a valuable resource and by cutting him out of our project (because our draft was still a draft) was subversively hurting us as a group. Now that we have all discussed it, however, I hope this will no longer be a problem.</p>

<p>As a team, I was surprised at the amount of accountability we had with each other, considering that the past couple weeks were much less structured. Every time we planned to meet up, we would text one another and make sure they were on their way. Josh helped out from home, which is great, and even stayed late on Thursday night, which can be a drag when having to drive so far. Dan's hectic work schedule got in the way a bit, but overall he was there when he was needed, and really helped pull together some of the major sections in our document. Overall, I think that we are on an upswing that will put us closer to the right track, and on time for completing our BIOS. Cheers!</p>

<h2>10/19/2012</h2>

<p>This week has been mostly focused on creating our Requirements Document. We have mostly been working on it through the Google doc and not in person, however we did meet up with Tosh and determine where we think we are on the project and the Requirements doc. We are still looking for more resources, most of which are either too detailed, or focused mainly on things we don't need to look at. Josh and I found a good couple of sites that have open source BIOS projects, but most are either incomplete or are a sort of amalgam of different softwares and firmwares. I downloaded the repository from one of them, called Coreboot, which I hope will help when we look through their code. So far as I understand it, the Coreboot system works by performing the necessary hardware initialization (which is what we are mainly interested in right now), then loads "payloads" which appear to be different bootstrapping programs. According to their wiki, the Linux kernel can be loaded payload free, so that is probably what we want to look at more in depth.</p>

<p>Our group is doing well, and now that I have no more PE classes, I have more time to work on things. Josh and Dan are both doing well and it appears they are making headway on their contacts. I have personally contacted Dillon Mark and asked him to see if he could forward us John Schock's information so we could get a hold of him. I am hopeful that we actually get to directly correspond with Mr. Schock soon.</p>

<h2>10/12/2012</h2>

<p>We now have a book from Dr. Crocker (thanks to Dan for that) about the ARM 11 architecture, which has some good stuff in it. Currently, we are still reviewing it, so there's not a lot of knowledge to throw down just yet. We also got more set up in our workroom. Meeting with Dr. Kakar on Wednesday was definitely valuable. He suggested that we meet up with Dillon Mark, who graduated last year and could be of some help, and John Schock, a BIOS engineer at Intel and alumnus of PLU. Josh has started posting on the Raspberry Pi forums, looking for advice, and I am trying to track down an email for Mr. Schock that is not linked with his LinkedIn account, considering I don't know how reliable that is to contact him. If by Saturday I can't find one, I'll shoot him a message over LinkedIn and see if he can be of help. We are also still planning on contacting Raspberry Pi directly and seeing if we can talk to someone there. Some issues we haven't worked out yet, there's no CMOS (I'm pretty sure it's CMOS) on the Pi itself, which means that the hardware must somehow already be configured to look at the SD card for all the necessary boot information before the BIOS loads up. We are currently looking into how that works.</p>

<p>Josh and Dan are both working hard, and with Dr. Kakar's help, I think we have a legitimate chance of pulling this off. After next week my schedule will open up considerably, and we will have a good amount of time in the mornings to work on capstone in our workroom. On Saturday, Dan and I are meeting up on Saturday and Josh will telecommute via Skype, so we can work more on our Requirements Doc. I plan on reading as much as I can about the ARM 11 until then (and during) and researching as much as I can about the exact process a computer goes through during BIOS. Our plan is to get a rough draft to Dr. Kakar by Thursday for him to look over, then revise, revise, revise until we have to turn it in. Cheers!</p>

<h2>10/4/2012</h2>

<p>Our group has set up regular meeting times, and we have our meetings with Prof. Kakar planned out. We are still working on our requirements document, and have hashed out a lot of potential problems with our project. We are still gathering resources at this point, but we are getting some literature going, as well as web articles. Since Raspberry Pi as a company is focused on education, we plan on attempting to make contact with them and see if we can correspond with someone, either short term or (preferably) long term.</p>

<p>As a team, I think we are working well. We just recently got our schedules together to coordinate meeting times more efficiently, and encountered an age-old problem: It's hard to meet up when we all have different schedules. Currently, I have the hardest time fitting things in to our meeting times. As a result, I feel as if I am not doing my share of work, but am still focused on email correspondence and meeting up whenever possible. After mid-semester break, I will have much more free time, and our group should hopefully be able to meet more easily.</p>

<p>Both Dan and Josh are working diligently. Josh lives pretty far away from school, so it's also hard meeting with him, but he is doing a great amount of research for us and has found some really helpful sources. Given his previous experience with lower-level programming, he is finding things I personally hadn't even considered looking for. Dan is also working hard; he and I meet up fairly regularly because we share another course. Dan's knowledge of circuits has come in handy in looking up the hardware configurations for the Raspberry Pi, and we've been able to make some pretty surprising discoveries because of it. Cheers!</p>

<h2>9/25/2012</h2>

<p>This is my first blog post! Not much to report, but we are starting some good preliminary research and are making some headway toward our requirements document. So far scheduling times for all three of us to meet has been difficult, but doable. Cheers!</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
